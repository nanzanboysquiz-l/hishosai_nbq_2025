<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>予約フォーム</title>
  <script>
    let timeOptions = {};

    async function fetchTimeSlots() {
      const res = await fetch("https://script.google.com/macros/s/AKfycbwO_S_JIllc2xl7Zvo3i3ZuB_RT_WEIlhXHnizu5ddbYF9oHkoVA-mHquKUTYhUaNCl/exec");
      timeOptions = await res.json();
    }

    function formatTime(isoString) {
      const date = new Date(isoString);
      const hh = String(date.getHours()).padStart(2, '0');
      const mm = String(date.getMinutes()).padStart(2, '0');
      return `${hh}:${mm}`;
    }

    function updateTimeSlots() {
      const content = document.getElementById("content").value;
      const timeSelect = document.getElementById("time");
      timeSelect.innerHTML = "";

      if (timeOptions[content]) {
        timeOptions[content].forEach(t => {
          const opt = document.createElement("option");
          opt.value = t;
          opt.textContent = formatTime(t); // ← 表示用に整形
          timeSelect.appendChild(opt);
        });
      }
    }

    async function submitForm(e) {
      e.preventDefault();
      const count = document.getElementById("count").value;
      const content = document.getElementById("content").value;
      const time = document.getElementById("time").value;

      const res = await fetch("YOUR_SCRIPT_URL", {
        method: "POST",
        body: JSON.stringify({ count, content, time }),
        headers: { "Content-Type": "application/json" }
      });

      const result = await res.json();
      document.getElementById("result").textContent =
        `予約No: ${result.no} / キャンセルコード: ${result.cancelCode}`;
    }

    window.onload = fetchTimeSlots;
  </script>
</head>
<body>
  <h2>予約登録フォーム</h2>
  <form onsubmit="submitForm(event)">
    <label>人数：</label>
    <input type="number" id="count" required><br>

    <label>内容：</label>
    <select id="content" onchange="updateTimeSlots()" required>
      <option value="">選択してください</option>
      <option value="初心者早押し">初心者早押し</option>
      <option value="初心者パネル">初心者パネル</option>
      <option value="経験者早押し">経験者早押し</option>
      <option value="経験者パネル">経験者パネル</option>
    </select><br>

    <label>時間枠：</label>
    <select id="time" required></select><br>

    <button type="submit">予約する</button>
  </form>

  <p id="result"></p>
</body>
</html>
